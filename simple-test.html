<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Simple Extension Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .test { padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .working { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Extension Quick Test</h1>
    
    <div id="apiTest" class="test">
        <strong>Extension API:</strong> <span id="apiResult">Testing...</span>
    </div>
    
    <div id="backgroundTest" class="test">
        <strong>Background Script:</strong> <span id="backgroundResult">Testing...</span>
    </div>
    
    <div id="blockingTest" class="test">
        <strong>Site Blocking:</strong> <span id="blockingResult">Testing...</span>
    </div>
    
    <div>
        <button onclick="testSiteBlocking()">Test Site Blocking</button>
        <button onclick="testUnblockProcess()">Test Unblock Process</button>
        <button onclick="blockCurrentSite()">Block This Site</button>
    </div>
    
    <div id="output" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }
        
        // Test Extension API
        function testAPI() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                document.getElementById('apiTest').className = 'test working';
                document.getElementById('apiResult').textContent = '‚úÖ Available';
                log('‚úÖ Extension API is available');
                return true;
            } else {
                document.getElementById('apiTest').className = 'test error';
                document.getElementById('apiResult').textContent = '‚ùå Not Available';
                log('‚ùå Extension API not available');
                return false;
            }
        }
        
        // Test Background Script
        async function testBackground() {
            try {
                const response = await chrome.runtime.sendMessage({action: 'getStats'});
                if (response) {
                    document.getElementById('backgroundTest').className = 'test working';
                    document.getElementById('backgroundResult').textContent = '‚úÖ Working';
                    log('‚úÖ Background script responding: ' + JSON.stringify(response));
                } else {
                    document.getElementById('backgroundTest').className = 'test error';
                    document.getElementById('backgroundResult').textContent = '‚ùå No Response';
                    log('‚ùå Background script not responding');
                }
            } catch (error) {
                document.getElementById('backgroundTest').className = 'test error';
                document.getElementById('backgroundResult').textContent = '‚ùå Error';
                log('‚ùå Background error: ' + error.message);
            }
        }
        
        // Test Site Blocking
        async function testSiteBlocking() {
            log('üîÑ Testing site blocking...');
            try {
                const response = await chrome.runtime.sendMessage({
                    action: 'getBlockedSites'
                });
                if (Array.isArray(response)) {
                    document.getElementById('blockingTest').className = 'test working';
                    document.getElementById('blockingResult').textContent = '‚úÖ Working';
                    log(`‚úÖ Site blocking working - ${response.length} sites blocked: ${response.join(', ')}`);
                } else {
                    document.getElementById('blockingTest').className = 'test error';
                    document.getElementById('blockingResult').textContent = '‚ùå Not Working';
                    log('‚ùå Site blocking not working');
                }
            } catch (error) {
                document.getElementById('blockingTest').className = 'test error';
                document.getElementById('blockingResult').textContent = '‚ùå Error';
                log('‚ùå Site blocking error: ' + error.message);
            }
        }
        
        // Test Unblock Process
        async function testUnblockProcess() {
            log('üîÑ Testing unblock process...');
            try {
                const response = await chrome.runtime.sendMessage({
                    action: 'startUnblock',
                    domain: 'example.com'
                });
                if (response && response.challenges) {
                    log(`‚úÖ Unblock process working - ${response.challenges.length} challenges generated`);
                } else {
                    log('‚ùå Unblock process not working - no challenges returned');
                }
            } catch (error) {
                log('‚ùå Unblock process error: ' + error.message);
            }
        }
        
        // Block Current Site
        async function blockCurrentSite() {
            const domain = window.location.hostname;
            log(`üîÑ Attempting to block ${domain}...`);
            try {
                const response = await chrome.runtime.sendMessage({
                    action: 'blockSite',
                    domain: domain
                });
                if (response) {
                    log(`‚úÖ Successfully blocked ${domain} - page will redirect soon`);
                    setTimeout(() => window.location.reload(), 3000);
                } else {
                    log(`‚ùå Failed to block ${domain}`);
                }
            } catch (error) {
                log('‚ùå Block site error: ' + error.message);
            }
        }
        
        // Run tests on page load
        document.addEventListener('DOMContentLoaded', async () => {
            log('üîÑ Running extension tests...');
            
            if (testAPI()) {
                await testBackground();
                await testSiteBlocking();
            }
            
            log('‚úÖ Initial tests completed');
        });
    </script>
</body>
</html>
